<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Three forecasting techniques | Sketchy Polytopes</title><meta name="description" content="Algorithms, optimization; systems, data, and people "><meta itemprop="name" content="Umayr Hassan"><meta itemprop="description" content="Algorithms, optimization; systems, data, and people "><meta itemprop="image" content="http://localhost:4000/assets/images/form_contact.jpg"><meta property="og:url" content="http://localhost:4000/2012/02/15/three-forecasting-techniques/"><meta property="og:type" content="website"><meta property="og:title" content="Three forecasting techniques | Sketchy Polytopes"><meta property="og:site_name" content="Sketchy Polytopes"><meta property="og:description" content="Algorithms, optimization; systems, data, and people "><meta property="og:image" content="http://localhost:4000/assets/images/form_contact.jpg"><meta name="twitter:url" content="http://localhost:4000/2012/02/15/three-forecasting-techniques/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Three forecasting techniques | Sketchy Polytopes"><meta name="twitter:site" content="Sketchy Polytopes"><meta name="twitter:description" content="Algorithms, optimization; systems, data, and people "><meta property="twitter:image" content="http://localhost:4000/assets/images/form_contact.jpg"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="Sketchy Polytopes" href="/feed.xml"><link rel="canonical" href="/2012/02/15/three-forecasting-techniques/"> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'], inlineMath: [['$','$']] } }); </script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body id="three-forecasting-techniques" class="post-layout"><header class="header"> <a class="header__title" href="http://localhost:4000/">Sketchy Polytopes</a><nav><ul class="header__list"><li><a href="/">Posts</a></li><li><a href="/notes">Notes</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="üíà"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Three forecasting techniques</h2><time class="post__date" datetime="2012-02-15T00:00:00-08:00" itemprop="datePublished">15 Feb 2012</time></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>How well are we doing when forecasting for online ads at <a href="http://adap.tv/" title="Adap.tv">Adap.tv</a>? Can we do better? To start answering such questions, I used <a href="http://cran.r-project.org/"><strong>R</strong></a> to experiment with three well-known forecasting techniques and used an hourly¬†metric (transformed for data privacy) across all ads for seven days (Feb 1-Feb 7) as my training data set. Then I use each of the techniques to predict for the eight day (Feb 8), and compare the predicted values with actual data. Here‚Äôs a synopsis of the three:</p><h2 id="exponential-weighted-moving-average-ewma_">Exponential Weighted Moving Average (EWMA)_</h2><p>Strictly speaking, the smoothing filter that we currently use at Adap.tv for forecasting is not EWMA, but more like Weighted Moving Average. EWMA is defined by:</p><p><img src="http://upload.wikimedia.org/wikipedia/en/math/a/3/a/a3a63410a8db7ce3ffae2a78d9ff74c9.png" alt="S_{t} = \alpha \times (Y_{t-1} + (1-\alpha) \times Y_{t-2} + (1-\alpha)^2 \times Y_{t-3} + ... + (1-\alpha)^k \times Y_{t-(k+1)}) + (1-\alpha)^{k+1} \times S_{t-(k+1)}" /> (<a href="http://en.wikipedia.org/wiki/Moving_average">ref</a>)</p><p>So, if a = 0.9, S[t] = 0.9 ( y[t-1] + 0.1*y[t-2] + 0.01*y[3] ‚Ä¶ 1e-6*y[t-7]) would be an implementation of EWMA. Instead, our implementation is be: S[t] = 0.9 ( y[t-1] + 0.9*y[t-2] + 0.81*y[3] ‚Ä¶ 0.531441*y[t-7]) / (0.9+‚Ä¶). The critical difference is in the way past data is weighted - with EWMA data in remote past is heavily penalized, whereas, comparatively, in our implementation it is not.</p><p>Fig. 1 below shows a plot that forecasts our metric for Feb 8 using Weighted Moving Average akin to our implementation. The metric forecasted for Feb 8 was 68392533 whereas observed value was 63868927, giving an absolute difference of ~7.1%. The absolute hourly differences lie between 0.6-29%.</p><p>Fig. 1, ‚ÄúWeighted moving average‚Äù <img src="/assets/images/wma2.png" alt="" /></p><h2 id="harmonic-regression_-harmonic-regression-attempts-to-find-the-best-fitting-periodic-signals-that-can">Harmonic regression_ Harmonic regression attempts to find the best-fitting periodic signals that can</h2><p>characterize a time series. For example, we a time series may be represented by a linear sum of sinusoids:</p><p><img src="http://upload.wikimedia.org/wikipedia/en/math/2/7/3/27359a25f09cb3722c2300b6daa9890e.png" alt="\frac{a_0}{2} + \sum_{n=1}^\infty \, [a_n \cos(nx) + b_n \sin(nx)]" /> (<a href="http://en.wikipedia.org/wiki/Fourier_series">ref</a>)</p><p>Generally, a combination of Fourier transform and least-squares regression in used to find the harmonics who linear sum best fit training data. In my experiment, I used the top seven harmonics with highest power density (i.e. contribution to the model), and then used linear regression to find their amplitudes. Fig. 2 shows the model (in red) and actual data (in blue). The forecast for Feb 8 was 60476559 whereas the observed value was 63868927, giving an absolute difference of ~5.3%. The absolute hourly differences lie between 0.05-25%.</p><p>Fig. 2, ‚ÄúHarmonic regression‚Äù <img src="/assets/images/harmreg2.png" alt="" />](/assets/images/harmreg2.png)</p><h2 id="holt-winters-method_">Holt-Winters method_</h2><p>Holt-Winters method augments EWMA to account for data trends and seasonality.</p><p><img src="http://upload.wikimedia.org/wikipedia/en/math/f/9/5/f95f5a3f2a31fc46fbf0f719629ffc0c.png" alt="\begin{align}&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; s_0&amp; = x_0\&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; s_{t}&amp; = \alpha \frac{x_{t}}{c_{t-L}} + (1-\alpha)F_t\&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; b_{t}&amp; = \beta (s_t - s_{t-1}) + (1-\beta)b_{t-1}\&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; c_{t}&amp; = \gamma \frac{x_{t}}{s_{t}}+(1-\gamma)c_{t-L}\&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; F_{t+m}&amp; = (s_t + mb_t)c_{(t+m) \pmod L},&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; \end{align}" />(<a href="http://en.wikipedia.org/wiki/Exponential_smoothing">ref</a>)</p><p>The model I used assumes that the seasonal component is additive (instead of being multiplicative). Fig. 3 illustrates the breakdown of seasonality, trend and randomness in the data,¬† Fig. 4 contrasts observed data with predicted data (note that the prediction start after one period, and the phase lag in predicted data), while Fig. 5 shows Holt-Winters prediction for Feb 8 versus observed data. The forecasted metric for Feb 8 was 63801332 whereas observed value was 63868927, giving an absolute difference of ~0.11%. The absolute hourly differences lie between 1.3-20%.</p><p>Fig. 3 <img src="/assets/images/holtwintersdecomposition2.png" alt="" title="Holt-Winters decomposition" />](/assets/images/holtwintersdecomposition2.png)</p><p>Fig. 4 <img src="/assets/images/holtwintersfit2.png" alt="" title="Holt-Winters observed/forecasted" />](/assets/images/holtwintersfit2.png)</p><p>Fig. 5 <img src="/assets/images/holtwintersprediction2.png" alt="" title="Prediction using Holt-Winters" />](/assets/images/holtwintersprediction2.png)</p><p>TO-DO</p><ul><li>Compare these models for other data set time ranges (weeks, months, quarters)</li><li>Compare these models for other metrics by sub-populations (e.g. by view domains)</li><li>Test for stationarity, or otherwise heteroscedasticity, across models and data sets. This may be critical since non-stationary time series should <em>not</em> be modeled with moving average methods</li><li>Compare models when data is uniformly sampled</li></ul></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Three forecasting techniques+http://localhost:4000/2012/02/15/three-forecasting-techniques/+by+Umayr Hassan" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Three forecasting techniques&summary=&url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=&url=http://localhost:4000/2012/02/15/three-forecasting-techniques/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">Posted by <a href="http://umayrh.github.io" title="More By Umayr Hassan">Umayr Hassan</a></span><p class="post__bio"></p></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get a weekly email of posts I‚Äôve added to the site.</p><form method="POST" action="&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/mathematics">Mathematics</a></li><li><a class="footer__link" href="/tag/algorithms">Algorithms</a></li><li><a class="footer__link" href="/tag/convex-optimization">Convex Optimization</a></li><li><a class="footer__link" href="/tag/obit">Obit</a></li><li><a class="footer__link" href="/tag/java">Java</a></li></ul><ul class="footer__social"><li><a href="https://www.linkedin.com/in/umayr/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/umayrh" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="https://gitlab.com/umayrh" target="_blank"><i class="fa fa-gitlab"></i></a></li><li><a href="https://umayrh.wordpress.com" target="_blank"><i class="fa fa-wordpress"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/form_contact.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/UuffFC2ATgC" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  