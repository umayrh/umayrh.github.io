<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>IP possibilities | Sketchy Polytopes</title><meta name="description" content="Algorithms, optimization; systems, data, and people "><meta itemprop="name" content="Umayr Hassan"><meta itemprop="description" content="Algorithms, optimization; systems, data, and people "><meta itemprop="image" content="http://localhost:4000/assets/images/form_contact.jpg"><meta property="og:url" content="http://localhost:4000/2012/05/24/ip-possibilities/"><meta property="og:type" content="website"><meta property="og:title" content="IP possibilities | Sketchy Polytopes"><meta property="og:site_name" content="Sketchy Polytopes"><meta property="og:description" content="Algorithms, optimization; systems, data, and people "><meta property="og:image" content="http://localhost:4000/assets/images/form_contact.jpg"><meta name="twitter:url" content="http://localhost:4000/2012/05/24/ip-possibilities/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="IP possibilities | Sketchy Polytopes"><meta name="twitter:site" content="Sketchy Polytopes"><meta name="twitter:description" content="Algorithms, optimization; systems, data, and people "><meta property="twitter:image" content="http://localhost:4000/assets/images/form_contact.jpg"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="Sketchy Polytopes" href="/feed.xml"><link rel="canonical" href="/2012/05/24/ip-possibilities/"> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'], inlineMath: [['$','$']] } }); </script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body id="ip-possibilities" class="post-layout"><header class="header"> <a class="header__title" href="http://localhost:4000/">Sketchy Polytopes</a><nav><ul class="header__list"><li><a href="/">Posts</a></li><li><a href="/notes">Notes</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="ðŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">IP possibilities</h2><time class="post__date" datetime="2012-05-24T00:00:00-07:00" itemprop="datePublished">24 May 2012</time></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>A problem I was asked: suppose a file that stored many valid IPv4 addresses was corrupted such that all dot in the addresses were removed. Given such a corrupt IP, infer all possible corresponding IP addresses. For example, given 12345, all possible addresses are: 12.3.4.5, 1.23.4.5, 1.2.34.5 and 1.2.3.45. The hint that recursion should be used made the problem easier:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MIN_TOKEN_SIZE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MAX_TOKEN_SIZE</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span> <span class="nf">getValidIPs</span><span class="o">(</span><span class="nc">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">int</span> <span class="n">remTokens</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">List</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
  <span class="kt">double</span> <span class="n">avgTokenSize</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">/</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">remTokens</span> <span class="o">;</span>
 
  <span class="k">if</span> <span class="o">((</span><span class="nc">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">avgTokenSize</span><span class="o">,</span> <span class="no">MIN_TOKEN_SIZE</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>          <span class="o">||</span> <span class="o">(</span><span class="nc">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">avgTokenSize</span><span class="o">,</span> <span class="no">MAX_TOKEN_SIZE</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">))</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">remTokens</span>       <span class="n">ip</span> <span class="o">=</span> <span class="n">getValidToken</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
 
  <span class="kt">int</span> <span class="n">maxTokenLen</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">remTokens</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="no">MAX_TOKEN_SIZE</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">minTokenLen</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="o">(</span><span class="n">remTokens</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">maxTokenLen</span><span class="o">,</span> <span class="no">MIN_TOKEN_SIZE</span><span class="o">);</span>
 
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">tokenLen</span> <span class="o">=</span> <span class="n">minTokenLen</span><span class="o">;</span> <span class="n">tokenLen</span>       <span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">tokenLen</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">tokenLen</span><span class="o">);</span>
 
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">getValidToken</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">prefix</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">continue</span><span class="o">;</span>
 
    <span class="nc">List</span> <span class="n">substrs</span> <span class="o">=</span> <span class="n">getValidIPs</span><span class="o">(</span><span class="n">remainder</span><span class="o">,</span> <span class="n">remTokens</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
 
    <span class="nc">StringBuffer</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">substr</span> <span class="o">:</span> <span class="n">substrs</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>
      <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'.'</span><span class="o">);</span>
      <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">substr</span><span class="o">);</span>
      <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">buf</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
      <span class="n">buf</span><span class="o">.</span><span class="na">setLength</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getValidToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">prefix</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span>       <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>     <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>     <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="o">)</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">return</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">val</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is a test result:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="s">"8880028"</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">remTokens</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
    <span class="nc">Set</span><span class="o">;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">getValidIPs</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span> <span class="n">remTokens</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">res</span> <span class="o">:</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">res</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div><p><code class="highlighter-rouge">8.88.0.28 8.88.2.8 88.8.0.28 88.80.2.8 8.8.8.28 8.8.80.28 88.8.2.8 88.80.0.28</code></p><p>Assuming we werenâ€™t validating IP correctness and wanted to know the number of permutation possible for given number of digits, n, to be split in four IP tokens; how can we go about it? A simple trick is to use to program to find out the sizes, C, of result set for all possible inputs, n:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n = 4, C = 1
n = 5, C = 4
n = 6, C = 10
n = 7, C = 16
n = 8, C = 19
n = 9, C = 16
n = 10, C = 10
n = 11, C = 4
n = 12, C = 1
</code></pre></div></div><p>There are at most four recursive calls, one for each token. Each token offers at most three possibilities, but not all the time. Hereâ€™s a clumsy recursion to express this program:</p><script type="math/tex; mode=display">D(m, n) = \sum\limits_{j}^{k} D(m-i, n-1) \\ k = \min (m-n+1, 3) \\ j = \max (m+k-kn, 1) \\ D(1 \leq m \leq 3, 1) = 1 \\ D(m \geq 4, 1) = 0 \\ n = 4 \\ 4 \leq m \leq 12</script><p>Desperate to find a closed-form solution to this problem, I searched and found the series (1, 4, 10, 16, 19, 16, 10, 4, 1) in Pascalâ€™s Pyramid [1], which is to trinomial numbers what Pascalâ€™s Triangle is to binomials. Summing the numbers in each column of the layer 4 of Pascalâ€™s pyramid gives:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1     |1|       |1|            |1|                     | 1|                              | 1|
---   1| |1    |2| |2|        |3| |3|                | 4|  | 4|                        | 5|  | 5|
 1    -----   1| |2| |1     |3| |6| |3|           | 6|  |12|  | 6|                  |10|  |20|  |10|
      1 1 1   ---------    1| |3| |3| |1       | 4|  |12|  |12|  | 4|            |10|  |30|  |30|  |10|
              1 2 3 2 1    -------------      1|  | 4|  | 6|  | 4|  | 1       | 5|  |20|  |30|  |20|  | 5|
                           1 3 6 7 6 3 1     --------------------------      1|  | 5|  |10|  |10|  | 5|  | 1
                                              1 04 10 16 19 16 10 04 01     --------------------------------
                                                                             1 05 15 30 45 51 45 30 15 05 01
</code></pre></div></div><p>For which we can derive a closed form. Given C(n, i, j), the trinomial coefficient for layer n, row i and column j; and C(i, j) the binomial coefficient for row i and column j:</p><script type="math/tex; mode=display">C(n, i, j) = C(n, i) \times C(i, j) \\ 0 \leq i \leq n \\ 0 \leq j \leq i</script><p>A number at a given column (or position) in our desired sequence is the sum of trinomial coefficients for alternating rows (even numbered rows for even m, and odd for odd) and given column. The sequence is symmetric about the median column:</p><script type="math/tex; mode=display">D(m, n) = \sum\limits_{i=m-n,i-=2}^{i \geq 0} C(n, i, \lfloor \frac{i}{2} \rfloor) \\ n \leq m \leq 2n \\ D(m, n) = D(4n-m, n)</script><p>It turns out that this problem is also related to enumerating lattice paths: Find the set A(n, k) of all lattice paths, from point (0, 0) to (n, k) in a Cartesian plane that use either an up-step (1,1), level-step (0, 1) or down-step (1, -1) [2].</p><p>Update (05/27/12): Corrected the closed-form equation.</p><p>References:</p><ul><li>[1] <a href="http://en.wikipedia.org/wiki/Pascal%27s_pyramid">Pascalâ€™s Pyramid</a></li><li>[2] A <a href="http://www.fq.math.ca/Scanned/40-1/woan.pdf">Combinatorial Proof</a> of a Recursive Relation of the Motzkin Sequence by Lattice Paths</li></ul></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=IP possibilities+http://localhost:4000/2012/05/24/ip-possibilities/+by+Umayr Hassan" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=IP possibilities&summary=&url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=&url=http://localhost:4000/2012/05/24/ip-possibilities/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">Posted by <a href="http://umayrh.github.io" title="More By Umayr Hassan">Umayr Hassan</a></span><p class="post__bio"></p></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get a weekly email of posts Iâ€™ve added to the site.</p><form method="POST" action="&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/mathematics">Mathematics</a></li><li><a class="footer__link" href="/tag/algorithms">Algorithms</a></li><li><a class="footer__link" href="/tag/convex-optimization">Convex Optimization</a></li><li><a class="footer__link" href="/tag/obit">Obit</a></li><li><a class="footer__link" href="/tag/linear-algebra">Linear Algebra</a></li></ul><ul class="footer__social"><li><a href="https://www.linkedin.com/in/umayr/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/umayrh" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="https://gitlab.com/umayrh" target="_blank"><i class="fa fa-gitlab"></i></a></li><li><a href="https://umayrh.wordpress.com" target="_blank"><i class="fa fa-wordpress"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/form_contact.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/UuffFC2ATgC" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  